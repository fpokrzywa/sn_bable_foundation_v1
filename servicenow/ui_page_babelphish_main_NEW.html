<?xml version="1.0" encoding="utf-8" ?>
<j:jelly trim="false" xmlns:j="jelly:core" xmlns:g="glide" xmlns:j2="null" xmlns:g2="null">
<g:evaluate>
var isLoggedIn = gs.getUser().getID() != '';
if (!isLoggedIn) {
  g.getSession().put('babelphish_return_url', g.getRequest().getRequestURL());
  response.sendRedirect('babelphish_login');
}
</g:evaluate>

<html>
<head>
  <title>BabelPhish - The Intelligent Experience</title>
  <g:inline src="babelphish_styles.css" />
</head>
<body>
  <div class="app" id="app-container">
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <h1>
          <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M6.5 12c.94-3.46 4.94-6 9.5-6 3.87 0 7 3.13 7 7s-3.13 7-7 7c-.53 0-1.04-.1-1.52-.26"/>
            <path d="M6 12c0-3.87 3.13-7 7-7 .53 0 1.04.1 1.52.26"/>
            <circle cx="12" cy="12" r="2"/>
          </svg>
          BabelPhish
        </h1>
        <button class="sidebar-toggle" onclick="toggleSidebar()" title="Collapse">
          <svg id="toggle-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
            <line x1="9" y1="3" x2="9" y2="21"/>
          </svg>
        </button>
      </div>

      <nav class="sidebar-nav" id="sidebar-nav">
        <!-- Expanded View -->
        <div id="expanded-nav">
          <!-- AI Tools -->
          <div class="nav-section">
            <div class="nav-item" data-section="aitools" onclick="toggleSection('aitools')">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
              </svg>
              <span>AI Tools</span>
              <svg class="chevron" id="chevron-aitools" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"/>
              </svg>
            </div>
            <div class="nav-subitems" id="aitools-subitems">
              <div class="nav-item" onclick="navigateTo('aistore')">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7"/>
                  <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/>
                  <path d="M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4"/>
                  <path d="M2 7h20"/>
                </svg>
                <span>AI Store</span>
              </div>
              <div class="nav-item" onclick="navigateTo('promptcatalog')">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                  <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                </svg>
                <span>Prompt Catalog</span>
              </div>
            </div>
          </div>

          <!-- Workspace -->
          <div class="nav-section">
            <div class="nav-item active" data-section="workspace" onclick="toggleSection('workspace')">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>
              </svg>
              <span>Workspace</span>
              <svg class="chevron" id="chevron-workspace" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="transform: rotate(90deg);">
                <polyline points="9 18 15 12 9 6"/>
              </svg>
            </div>
            <div class="nav-subitems open" id="workspace-subitems">
              <div class="nav-item active" onclick="navigateTo('mainworkspace')">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>
                </svg>
                <span>Main Workspace</span>
              </div>
              <div class="nav-item" onclick="navigateTo('mychanges')">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>
                </svg>
                <span>My Changes</span>
              </div>
              <div class="nav-item" onclick="navigateTo('incidents')">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>
                </svg>
                <span>Incidents</span>
              </div>
              <div class="nav-item" onclick="navigateTo('bable')">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>
                </svg>
                <span>Bable</span>
              </div>
            </div>
          </div>

          <!-- User -->
          <div class="nav-section">
            <div class="nav-item" data-section="user" onclick="toggleSection('user')">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
              </svg>
              <span>User</span>
              <svg class="chevron" id="chevron-user" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"/>
              </svg>
            </div>
            <div class="nav-subitems" id="user-subitems">
              <div class="nav-item" onclick="navigateTo('profile')">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/>
                  <circle cx="12" cy="7" r="4"/>
                </svg>
                <span>Profile &amp; Settings</span>
              </div>
            </div>
          </div>

          <!-- Find Answers -->
          <div class="nav-section">
            <div class="nav-item" data-section="findanswers" onclick="toggleSection('findanswers')">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                <line x1="12" y1="17" x2="12.01" y2="17"/>
              </svg>
              <span>Find Answers</span>
              <svg class="chevron" id="chevron-findanswers" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"/>
              </svg>
            </div>
            <div class="nav-subitems" id="findanswers-subitems">
              <div class="nav-item" onclick="navigateTo('findanswers-itsupport')">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                </svg>
                <span>IT Support Guides</span>
              </div>
              <div class="nav-item" onclick="navigateTo('findanswers-mysupport')">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                </svg>
                <span>My Support Guides</span>
              </div>
              <div class="nav-item" onclick="navigateTo('findanswers-hrpolicies')">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                </svg>
                <span>HR Policies</span>
              </div>
              <div class="nav-item" onclick="navigateTo('findanswers-nieaguides')">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                </svg>
                <span>NIEA Guides</span>
              </div>
              <div class="nav-item" onclick="navigateTo('findanswers-adeptguides')">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                </svg>
                <span>ADEPT Guides</span>
              </div>
              <div class="nav-item" onclick="navigateTo('findanswers-freddieit')">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                </svg>
                <span>Freddie is IT</span>
              </div>
            </div>
          </div>

          <!-- Administration -->
          <div class="nav-section">
            <div class="nav-item" data-section="administration" onclick="toggleSection('administration')">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
              </svg>
              <span>Administration</span>
              <svg class="chevron" id="chevron-administration" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"/>
              </svg>
            </div>
            <div class="nav-subitems" id="administration-subitems">
              <div class="nav-item" onclick="navigateTo('usermanagement')">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                  <circle cx="9" cy="7" r="4"/>
                  <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                  <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
                <span>User Management</span>
              </div>
              <div class="nav-item" onclick="navigateTo('rolemanagement')">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="3"/>
                  <path d="M12 1v6m0 6v6"/>
                  <path d="m4.2 4.2 4.2 4.2m5.2 5.2 4.2 4.2"/>
                  <path d="M1 12h6m6 0h6"/>
                  <path d="m4.2 19.8 4.2-4.2m5.2-5.2 4.2-4.2"/>
                </svg>
                <span>Role Management</span>
              </div>
              <div class="nav-item" onclick="navigateTo('companymanagement')">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="2" y="7" width="20" height="14" rx="2" ry="2"/>
                  <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/>
                </svg>
                <span>Company Management</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Collapsed View -->
        <div id="collapsed-nav" style="display: none;">
          <!-- AI Store Direct Link -->
          <div class="nav-item" onclick="navigateTo('aistore')" title="AI Store">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7"/>
              <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/>
              <path d="M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4"/>
              <path d="M2 7h20"/>
            </svg>
          </div>

          <!-- Prompt Catalog Direct Link -->
          <div class="nav-item" onclick="navigateTo('promptcatalog')" title="Prompt Catalog">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
              <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
            </svg>
          </div>

          <!-- Workspace Flyout -->
          <div class="collapsed-menu-wrapper">
            <div class="nav-item" onclick="toggleCollapsedMenu('workspace')" title="Workspace">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>
              </svg>
            </div>
            <div class="collapsed-submenu" id="collapsed-workspace-menu" style="display: none;">
              <div class="collapsed-submenu-item" onclick="navigateTo('mainworkspace'); hideCollapsedMenu('workspace');">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>
                </svg>
                <span>Main Workspace</span>
              </div>
              <div class="collapsed-submenu-item" onclick="navigateTo('mychanges'); hideCollapsedMenu('workspace');">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>
                </svg>
                <span>My Changes</span>
              </div>
              <div class="collapsed-submenu-item" onclick="navigateTo('incidents'); hideCollapsedMenu('workspace');">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>
                </svg>
                <span>Incidents</span>
              </div>
              <div class="collapsed-submenu-item" onclick="navigateTo('bable'); hideCollapsedMenu('workspace');">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>
                </svg>
                <span>Bable</span>
              </div>
            </div>
          </div>

          <!-- Find Answers Flyout -->
          <div class="collapsed-menu-wrapper">
            <div class="nav-item" onclick="toggleCollapsedMenu('findanswers')" title="Find Answers">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                <line x1="12" y1="17" x2="12.01" y2="17"/>
              </svg>
            </div>
            <div class="collapsed-submenu" id="collapsed-findanswers-menu" style="display: none;">
              <div class="collapsed-submenu-item" onclick="navigateTo('findanswers-itsupport'); hideCollapsedMenu('findanswers');">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                </svg>
                <span>IT Support Guides</span>
              </div>
              <div class="collapsed-submenu-item" onclick="navigateTo('findanswers-mysupport'); hideCollapsedMenu('findanswers');">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                </svg>
                <span>My Support Guides</span>
              </div>
              <div class="collapsed-submenu-item" onclick="navigateTo('findanswers-hrpolicies'); hideCollapsedMenu('findanswers');">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                </svg>
                <span>HR Policies</span>
              </div>
              <div class="collapsed-submenu-item" onclick="navigateTo('findanswers-nieaguides'); hideCollapsedMenu('findanswers');">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                </svg>
                <span>NIEA Guides</span>
              </div>
              <div class="collapsed-submenu-item" onclick="navigateTo('findanswers-adeptguides'); hideCollapsedMenu('findanswers');">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                </svg>
                <span>ADEPT Guides</span>
              </div>
              <div class="collapsed-submenu-item" onclick="navigateTo('findanswers-freddieit'); hideCollapsedMenu('findanswers');">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                </svg>
                <span>Freddie is IT</span>
              </div>
            </div>
          </div>
        </div>
      </nav>

      <div class="sidebar-footer">
        <div class="user-info">
          <j:set var="currentUser" value="${gs.getUser()}" />
          ${currentUser.getEmail()}
        </div>
        <button class="logout-btn" onclick="logoutUser()" title="Logout">
          <svg class="icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
            <polyline points="16 17 21 12 16 7"/>
            <line x1="21" y1="12" x2="9" y2="12"/>
          </svg>
          <span>Logout</span>
        </button>
      </div>
    </div>

    <div class="main-content">
      <!-- Welcome Page -->
      <div class="page-container active" id="welcome-page">
        <div class="welcome-container">
          <svg class="fish-icon" viewBox="0 0 200 200" fill="none">
            <circle cx="100" cy="100" r="80" fill="#0ea5e9"/>
            <circle cx="120" cy="85" r="8" fill="#1e293b"/>
            <path d="M20 100 L60 80 L60 120 Z" fill="#fbbf24"/>
          </svg>

          <h1 class="welcome-title">Welcome to BabelPhish</h1>
          <p class="welcome-subtitle">
            Start by typing a command or query below to create your first widget.
          </p>

          <div class="quick-actions">
            <p class="quick-actions-title">Quick browse items</p>
            <div class="action-links">
              <a class="action-link" href="javascript:void(0)">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                </svg>
                <span>Get my incidents</span>
              </a>
              <a class="action-link" href="javascript:void(0)">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                </svg>
                <span>Show me high priority changes</span>
              </a>
              <a class="action-link" href="javascript:void(0)">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                </svg>
                <span>Are there any recurring problems?</span>
              </a>
            </div>
          </div>

          <div class="input-container">
            <input
              type="text"
              class="message-input"
              placeholder="Please type your message here"
              id="messageInput"
            />
            <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" onclick="sendMessage()">
              <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
            </svg>
          </div>

          <div class="input-footer">
            <button>Use Commands</button>
            <button>Workspace</button>
          </div>
        </div>
      </div>

      <!-- Other pages remain the same... -->
      <!-- To save space, I'll note that AI Store, Prompt Catalog, and Find Answers pages continue here -->
    </div>
  </div>

  <script>
    var isCollapsed = false;
    var collapsedMenus = {
      workspace: false,
      findanswers: false
    };

    function toggleSidebar() {
      isCollapsed = !isCollapsed;
      var sidebar = document.getElementById('sidebar');
      var appContainer = document.getElementById('app-container');
      var toggleIcon = document.getElementById('toggle-icon');
      var expandedNav = document.getElementById('expanded-nav');
      var collapsedNav = document.getElementById('collapsed-nav');

      if (isCollapsed) {
        sidebar.classList.add('collapsed');
        appContainer.classList.add('sidebar-collapsed');
        expandedNav.style.display = 'none';
        collapsedNav.style.display = 'block';

        // Change icon to PanelLeftOpen
        toggleIcon.innerHTML = '<path d="M3 3h18v18H3z"/><path d="M15 3v18"/>';

        var toggleButton = document.querySelector('.sidebar-toggle');
        toggleButton.setAttribute('title', 'Expand');
      } else {
        sidebar.classList.remove('collapsed');
        appContainer.classList.remove('sidebar-collapsed');
        expandedNav.style.display = 'block';
        collapsedNav.style.display = 'none';

        // Change icon to PanelLeftClose
        toggleIcon.innerHTML = '<rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="9" y1="3" x2="9" y2="21"/>';

        var toggleButton = document.querySelector('.sidebar-toggle');
        toggleButton.setAttribute('title', 'Collapse');

        // Hide all collapsed menus
        hideAllCollapsedMenus();
      }
    }

    function toggleSection(sectionName) {
      var subitems = document.getElementById(sectionName + '-subitems');
      var chevron = document.getElementById('chevron-' + sectionName);

      if (!subitems) return;

      var isOpen = subitems.classList.contains('open');

      // Close all other sections
      document.querySelectorAll('.nav-subitems').forEach(function(otherSubitems) {
        if (otherSubitems !== subitems) {
          otherSubitems.classList.remove('open');
        }
      });

      // Reset all other chevrons
      document.querySelectorAll('.chevron').forEach(function(otherChevron) {
        if (otherChevron !== chevron) {
          otherChevron.style.transform = 'rotate(0deg)';
        }
      });

      if (isOpen) {
        subitems.classList.remove('open');
        chevron.style.transform = 'rotate(0deg)';
      } else {
        subitems.classList.add('open');
        chevron.style.transform = 'rotate(90deg)';
      }
    }

    function toggleCollapsedMenu(menuName) {
      var menu = document.getElementById('collapsed-' + menuName + '-menu');
      if (!menu) return;

      // Close other menus
      for (var key in collapsedMenus) {
        if (key !== menuName && collapsedMenus[key]) {
          hideCollapsedMenu(key);
        }
      }

      collapsedMenus[menuName] = !collapsedMenus[menuName];
      menu.style.display = collapsedMenus[menuName] ? 'block' : 'none';
    }

    function hideCollapsedMenu(menuName) {
      var menu = document.getElementById('collapsed-' + menuName + '-menu');
      if (menu) {
        menu.style.display = 'none';
        collapsedMenus[menuName] = false;
      }
    }

    function hideAllCollapsedMenus() {
      for (var key in collapsedMenus) {
        hideCollapsedMenu(key);
      }
    }

    function navigateTo(destination) {
      console.log('Navigating to: ' + destination);

      // Hide all collapsed menus
      hideAllCollapsedMenus();

      // Remove active class from all items
      document.querySelectorAll('.nav-item').forEach(function(item) {
        item.classList.remove('active');
      });

      // Hide all pages
      document.querySelectorAll('.page-container').forEach(function(page) {
        page.classList.remove('active');
      });

      // Show the requested page
      if (destination === 'aistore') {
        document.getElementById('aistore-page').classList.add('active');
      } else if (destination === 'promptcatalog') {
        document.getElementById('promptcatalog-page').classList.add('active');
      } else if (destination.indexOf('findanswers-') === 0) {
        var category = destination.replace('findanswers-', '');
        showFindAnswersPage(category);
      } else {
        document.getElementById('welcome-page').classList.add('active');
      }
    }

    function logoutUser() {
      if (confirm('Are you sure you want to logout?')) {
        window.location.href = '/logout.do';
      }
    }

    function sendMessage() {
      var input = document.getElementById('messageInput');
      var message = input.value.trim();
      if (message) {
        console.log('Message: ' + message);
        input.value = '';
      }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      // Add message input enter key handler
      document.getElementById('messageInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          sendMessage();
        }
      });
    });
  </script>
</body>
</html>
</j:jelly>
